<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Les Histoires de Cédric</title>
  <link rel="stylesheet" href="styles.css" />
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyC7Sf-tNwFJM3W8NhS0seX7ziswedDoubw",
      authDomain: "histoires-magique.firebaseapp.com",
      projectId: "histoires-magique",
      storageBucket: "histoires-magique.firebasestorage.app",
      messagingSenderId: "716616002326",
      appId: "1:716616002326:web:fb572801eb5869b33dfe37"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();
  </script>
  <style>
    /* Styles pour les interactions */
    .interaction-buttons {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5rem 0;
      margin-top: 0.5rem;
    }

    .like-btn, .show-comments-btn {
      display: flex;
      align-items: center;
      gap: 0.3rem;
      padding: 0.5rem 0.8rem;
      border-radius: 20px;
      border: none;
      background-color: #f5f5f5;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.9rem;
    }

    .like-btn {
      color: #e74c3c;
    }

    .show-comments-btn {
      color: #3498db;
    }

    .like-btn:hover {
      background-color: #ffebee;
      transform: scale(1.05);
    }

    .show-comments-btn:hover {
      background-color: #e3f2fd;
      transform: scale(1.05);
    }

    .icon {
      font-size: 1.1rem;
    }

    .comment-text {
      font-weight: 500;
    }

    /* Mode nuit */
    body.nuit .like-btn,
    body.nuit .show-comments-btn {
      background-color: #2c3e50;
      color: #ecf0f1;
    }

    body.nuit .like-btn:hover {
      background-color: #4a2a2a;
    }

    body.nuit .show-comments-btn:hover {
      background-color: #2a3a4a;
    }

    .comment-section {
      margin-top: 0.5rem;
      padding: 0.8rem;
      background: #f9f9f9;
      border-radius: 8px;
      display: none;
    }

    body.nuit .comment-section {
      background: #2c2c3b;
    }
  </style>
</head>
<body>

  <div id="monElement"></div>

  <!-- 🌙 Bouton Mode Nuit -->
  <button id="toggle-mode" title="Mode nuit">🌙</button>

  <!-- Contenu principal -->
  <div id="content">
    <header>
      <h1>📚 Il était une fois...</h1>
      <p>Découvre un monde d'histoires à lire, écouter ou rêver.</p>
    </header>
    <section id="bibliotheque">
      <div class="carte">
        <img src="assets/lune.jpg" alt="Illustration de l'histoire" />
        <h2>La Lune et le Bananier</h2>
        <p>Un conte doux venu du ciel africain.</p>
        <a href="histoires/lune.html">Lire l'histoire ➜</a>
        <div class="interactions">
          <div class="interaction-buttons">
            <button class="like-btn" data-story-id="lune">
              <span class="icon">❤️</span>
              <span class="like-count">0</span>
            </button>
            <button class="show-comments-btn" data-story-id="lune">
              <span class="icon">💬</span>
              <span class="comment-text">Commenter</span>
            </button>
          </div>
          <div class="comment-section">
            <input type="text" class="comment-input" placeholder="Ajouter un commentaire...">
            <button class="comment-btn" data-story-id="lune">Publier</button>
            <div class="comments-list"></div>
          </div>
        </div>
      </div>

      <div class="carte">
        <img src="assets/chien-magique.jpg" alt="Chien magique" />
        <h2>Jojo le Chien Magique</h2>
        <p>Une aventure malicieuse et pleine de rires.</p>
        <a href="histoires/jojo.html">Lire l'histoire ➜</a>
        <div class="interactions">
          <div class="interaction-buttons">
            <button class="like-btn" data-story-id="chien-magique">
              <span class="icon">❤️</span>
              <span class="like-count">0</span>
            </button>
            <button class="show-comments-btn" data-story-id="chien-magique">
              <span class="icon">💬</span>
              <span class="comment-text">Commenter</span>
            </button>
          </div>
          <div class="comment-section">
            <input type="text" class="comment-input" placeholder="Ajouter un commentaire...">
            <button class="comment-btn" data-story-id="chien-magique">Publier</button>
            <div class="comments-list"></div>
          </div>
        </div>
      </div>

      <!-- Autres cartes d'histoires avec le même pattern -->
      <div class="carte">
        <img src="assets/banc-solitaire.jpg" alt="Illustration de l'histoire" />
        <h2>Le Banc qui Attendait</h2>
        <p>Un conte doux venu du ciel africain.</p>
        <a href="histoires/Banc.html">Lire l'histoire ➜</a>
        <div class="interactions">
          <div class="interaction-buttons">
            <button class="like-btn" data-story-id="banc-solitaire">
              <span class="icon">❤️</span>
              <span class="like-count">0</span>
            </button>
            <button class="show-comments-btn" data-story-id="banc-solitaire">
              <span class="icon">💬</span>
              <span class="comment-text">Commenter</span>
            </button>
          </div>
          <div class="comment-section">
            <input type="text" class="comment-input" placeholder="Ajouter un commentaire...">
            <button class="comment-btn" data-story-id="banc-solitaire">Publier</button>
            <div class="comments-list"></div>
          </div>
        </div>
      </div>

      <div class="carte">
        <img src="assets/bottine-perdue.jpg" alt="Chien magique" />
        <h2>👢 La Bottine Voyageuse</h2>
        <p>Une aventure malicieuse et pleine de rires.</p>
        <a href="histoires/Bottine.html">Lire l’histoire ➜</a>
        <div class="interactions">
          <div class="interaction-buttons">
            <button class="like-btn" data-story-id="bottine">
              <span class="icon">❤️</span>
              <span class="like-count">0</span>
            </button>
            <button class="show-comments-btn" data-story-id="bottine">
              <span class="icon">💬</span>
              <span class="comment-text">Commenter</span>
            </button>
          </div>
          <div class="comment-section">
            <input type="text" class="comment-input" placeholder="Ajouter un commentaire...">
            <button class="comment-btn" data-story-id="bottine">Publier</button>
            <div class="comments-list"></div>
          </div>
        </div>
      </div>

      <div class="carte">
        <img src="assets/chapeau-vent.jpg" alt="Illustration de l'histoire" />
        <h2>🎩 Le Chapeau du Vent</h2>
        <p>Un conte doux venu du ciel africain.</p>
        <a href="histoires/Chapeau.html">Lire l’histoire ➜</a>
        <div class="interactions">
          <div class="interaction-buttons">
            <button class="like-btn" data-story-id="chapeau">
              <span class="icon">❤️</span>
              <span class="like-count">0</span>
            </button>
            <button class="show-comments-btn" data-story-id="chapeau">
              <span class="icon">💬</span>
              <span class="comment-text">Commenter</span>
            </button>
          </div>
          <div class="comment-section">
            <input type="text" class="comment-input" placeholder="Ajouter un commentaire...">
            <button class="comment-btn" data-story-id="chapeau">Publier</button>
            <div class="comments-list"></div>
          </div>
        </div>
      </div>

      <!-- Autres cartes d'histoires avec le même pattern -->
      <div class="carte">
        <img src="assets/cle-vieille.jpg" alt="Chien magique" />
        <h2>🗝️ La Clé sans Porte</h2>
        <p>Une aventure malicieuse et pleine de rires.</p>
        <a href="histoires/Cle.html">Lire l’histoire ➜</a>
        <div class="interactions">
          <div class="interaction-buttons">
            <button class="like-btn" data-story-id="cle">
              <span class="icon">❤️</span>
              <span class="like-count">0</span>
            </button>
            <button class="show-comments-btn" data-story-id="cle">
              <span class="icon">💬</span>
              <span class="comment-text">Commenter</span>
            </button>
          </div>
          <div class="comment-section">
            <input type="text" class="comment-input" placeholder="Ajouter un commentaire...">
            <button class="comment-btn" data-story-id="cle">Publier</button>
            <div class="comments-list"></div>
          </div>
        </div>
      </div>

      <div class="carte">
        <img src="assets/crayon-dormant.jpg" alt="Illustration de l'histoire" />
        <h2>✏️ Le Crayon qui ne Dessinait Plus</h2>
        <p>Un conte doux venu du ciel africain.</p>
        <a href="histoires/Crayon.html">Lire l’histoire ➜</a>
        <div class="interactions">
          <div class="interaction-buttons">
            <button class="like-btn" data-story-id="crayon">
              <span class="icon">❤️</span>
              <span class="like-count">0</span>
            </button>
            <button class="show-comments-btn" data-story-id="crayon">
              <span class="icon">💬</span>
              <span class="comment-text">Commenter</span>
            </button>
          </div>
          <div class="comment-section">
            <input type="text" class="comment-input" placeholder="Ajouter un commentaire...">
            <button class="comment-btn" data-story-id="crayon">Publier</button>
            <div class="comments-list"></div>
          </div>
        </div>
      </div>

      <div class="carte">
        <img src="assets/echelle-ciel.jpg" alt="Chien magique" />
        <h2>🪜 L’Échelle vers Maintenant</h2>
        <p>Une aventure malicieuse et pleine de rires.</p>
        <a href="histoires/Echelle.html">Lire l’histoire ➜</a>
        <div class="interactions">
          <div class="interaction-buttons">
            <button class="like-btn" data-story-id="echelle">
              <span class="icon">❤️</span>
              <span class="like-count">0</span>
            </button>
            <button class="show-comments-btn" data-story-id="echelle">
              <span class="icon">💬</span>
              <span class="comment-text">Commenter</span>
            </button>
          </div>
          <div class="comment-section">
            <input type="text" class="comment-input" placeholder="Ajouter un commentaire...">
            <button class="comment-btn" data-story-id="echelle">Publier</button>
            <div class="comments-list"></div>
          </div>
        </div>
      </div>

      <!-- Autres cartes d'histoires avec le même pattern -->
      <div class="carte">
        <img src="assets/etoile-mare.jpg" alt="Illustration de l'histoire" />
        <h2>⭐ L’Étoile tombée dans la Mare</h2>
        <p>Un conte doux venu du ciel africain.</p>
        <a href="histoires/etoile.html">Lire l’histoire ➜</a>
        <div class="interactions">
          <div class="interaction-buttons">
            <button class="like-btn" data-story-id="etoile">
              <span class="icon">❤️</span>
              <span class="like-count">0</span>
            </button>
            <button class="show-comments-btn" data-story-id="etoile">
              <span class="icon">💬</span>
              <span class="comment-text">Commenter</span>
            </button>
          </div>
          <div class="comment-section">
            <input type="text" class="comment-input" placeholder="Ajouter un commentaire...">
            <button class="comment-btn" data-story-id="etoile">Publier</button>
            <div class="comments-list"></div>
          </div>
        </div>
      </div>

      <div class="carte">
        <img src="assets/graine-nuage.jpg" alt="Chien magique" />
        <h2>🌱 La Graine et le Nuage</h2>
        <p>Une aventure malicieuse et pleine de rires.</p>
        <a href="histoires/Graine.html">Lire l’histoire ➜</a>
        <div class="interactions">
          <div class="interaction-buttons">
            <button class="like-btn" data-story-id="graine-nuage">
              <span class="icon">❤️</span>
              <span class="like-count">0</span>
            </button>
            <button class="show-comments-btn" data-story-id="graine-nuage">
              <span class="icon">💬</span>
              <span class="comment-text">Commenter</span>
            </button>
          </div>
          <div class="comment-section">
            <input type="text" class="comment-input" placeholder="Ajouter un commentaire...">
            <button class="comment-btn" data-story-id="graine-nuage">Publier</button>
            <div class="comments-list"></div>
          </div>
        </div>
      </div>

      <div class="carte">
        <img src="assets/miroir-brise.jpg" alt="Illustration de l'histoire" />
        <h2>🪞 Le Miroir qui Tremblait</h2>
        <p>Un conte doux venu du ciel africain.</p>
        <a href="histoires/Mirroir.html">Lire l’histoire ➜</a>
        <div class="interactions">
          <div class="interaction-buttons">
            <button class="like-btn" data-story-id="miroir-brise">
              <span class="icon">❤️</span>
              <span class="like-count">0</span>
            </button>
            <button class="show-comments-btn" data-story-id="miroir-brise">
              <span class="icon">💬</span>
              <span class="comment-text">Commenter</span>
            </button>
          </div>
          <div class="comment-section">
            <input type="text" class="comment-input" placeholder="Ajouter un commentaire...">
            <button class="comment-btn" data-story-id="miroir-brise">Publier</button>
            <div class="comments-list"></div>
          </div>
        </div>
      </div>

      <!-- Autres cartes d'histoires avec le même pattern -->
      <div class="carte">
        <img src="assets/montre-silence.jpg" alt="Chien magique" />
        <h2>⌚ Le Silence et la Montre</h2>
        <p>Une aventure malicieuse et pleine de rires.</p>
        <a href="histoires/Montre.html">Lire l’histoire ➜</a>
        <div class="interactions">
          <div class="interaction-buttons">
            <button class="like-btn" data-story-id="montre-silence">
              <span class="icon">❤️</span>
              <span class="like-count">0</span>
            </button>
            <button class="show-comments-btn" data-story-id="montre-silence">
              <span class="icon">💬</span>
              <span class="comment-text">Commenter</span>
            </button>
          </div>
          <div class="comment-section">
            <input type="text" class="comment-input" placeholder="Ajouter un commentaire...">
            <button class="comment-btn" data-story-id="montre-silence">Publier</button>
            <div class="comments-list"></div>
          </div>
        </div>
      </div>

      <div class="carte">
        <img src="assets/pierre-ruisseau.jpg" alt="Illustration de l'histoire" />
        <h2>🪨 La Pierre et le Ruisseau</h2>
        <p>Un conte doux venu du ciel africain.</p>
        <a href="histoires/Pierre.html">Lire l’histoire ➜</a>
        <div class="interactions">
          <div class="interaction-buttons">
            <button class="like-btn" data-story-id="pierre-ruisseau">
              <span class="icon">❤️</span>
              <span class="like-count">0</span>
            </button>
            <button class="show-comments-btn" data-story-id="pierre-ruisseau">
              <span class="icon">💬</span>
              <span class="comment-text">Commenter</span>
            </button>
          </div>
          <div class="comment-section">
            <input type="text" class="comment-input" placeholder="Ajouter un commentaire...">
            <button class="comment-btn" data-story-id="pierre-ruisseau">Publier</button>
            <div class="comments-list"></div>
          </div>
        </div>
      </div>

      <div class="carte">
        <img src="assets/plume-ciel.jpg" alt="Chien magique" />
        <h2>🪶 La Plume qui Tombait Lentement</h2>
        <p>Une aventure malicieuse et pleine de rires.</p>
        <a href="histoires/Plume.html">Lire l’histoire ➜</a>
        <div class="interactions">
          <div class="interaction-buttons">
            <button class="like-btn" data-story-id="plume-ciel">
              <span class="icon">❤️</span>
              <span class="like-count">0</span>
            </button>
            <button class="show-comments-btn" data-story-id="plume-ciel">
              <span class="icon">💬</span>
              <span class="comment-text">Commenter</span>
            </button>
          </div>
          <div class="comment-section">
            <input type="text" class="comment-input" placeholder="Ajouter un commentaire...">
            <button class="comment-btn" data-story-id="plume-ciel">Publier</button>
            <div class="comments-list"></div>
          </div>
        </div>
      </div>

      <!-- Autres cartes d'histoires avec le même pattern -->
      <div class="carte">
        <img src="assets/chat-soleil.jpg" alt="Illustration de l'histoire" />
        <h2>☀️ Le Chat et le Rayon de Soleil</h2>
        <p>Un conte doux venu du ciel africain.</p>
        <a href="histoires/Soleil.html">Lire l’histoire ➜</a>
        <div class="interactions">
          <div class="interaction-buttons">
            <button class="like-btn" data-story-id="chat-soleil">
              <span class="icon">❤️</span>
              <span class="like-count">0</span>
            </button>
            <button class="show-comments-btn" data-story-id="chat-soleil">
              <span class="icon">💬</span>
              <span class="comment-text">Commenter</span>
            </button>
          </div>
          <div class="comment-section">
            <input type="text" class="comment-input" placeholder="Ajouter un commentaire...">
            <button class="comment-btn" data-story-id="chat-soleil">Publier</button>
            <div class="comments-list"></div>
          </div>
        </div>
      </div>

      <div class="carte">
        <img src="assets/tasse-ancienne.jpg" alt="Chien magique" />
        <h2>☕ La Tasse qui Écoutait</h2>
        <p>Une aventure malicieuse et pleine de rires.</p>
        <a href="histoires/Tasse.html">Lire l’histoire ➜</a>
        <div class="interactions">
          <div class="interaction-buttons">
            <button class="like-btn" data-story-id="tasse-ancienne">
              <span class="icon">❤️</span>
              <span class="like-count">0</span>
            </button>
            <button class="show-comments-btn" data-story-id="tasse-ancienne">
              <span class="icon">💬</span>
              <span class="comment-text">Commenter</span>
            </button>
          </div>
          <div class="comment-section">
            <input type="text" class="comment-input" placeholder="Ajouter un commentaire...">
            <button class="comment-btn" data-story-id="tasse-ancienne">Publier</button>
            <div class="comments-list"></div>
          </div>
        </div>
      </div>

      <div class="carte">
        <img src="assets/vent-tambour.jpg" alt="Chien magique" />
        <h2>🌬️ Le Vent et le Tambour</h2>
        <p>Une aventure malicieuse et pleine de rires.</p>
        <a href="histoires/Vent.html">Lire l’histoire ➜</a>
        <div class="interactions">
          <div class="interaction-buttons">
            <button class="like-btn" data-story-id="vent-tambour">
              <span class="icon">❤️</span>
              <span class="like-count">0</span>
            </button>
            <button class="show-comments-btn" data-story-id="vent-tambour">
              <span class="icon">💬</span>
              <span class="comment-text">Commenter</span>
            </button>
          </div>
          <div class="comment-section">
            <input type="text" class="comment-input" placeholder="Ajouter un commentaire...">
            <button class="comment-btn" data-story-id="vent-tambour">Publier</button>
            <div class="comments-list"></div>
          </div>
        </div>
      </div>


      <!-- Continuez avec le même pattern pour toutes les autres cartes -->
      <!-- ... autres cartes d'histoires ... -->

    </section>

    <footer>
      <p>✨ Site imaginé par Cédric – Que chaque heure vous raconte quelque chose</p>
    </footer>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      // Gestion de l'affichage des commentaires
      document.querySelectorAll(".show-comments-btn").forEach(btn => {
        btn.addEventListener("click", function() {
          const commentSection = this.closest('.interaction-buttons').nextElementSibling;
          commentSection.style.display = commentSection.style.display === "none" ? "block" : "none";
          
          if (commentSection.dataset.loaded !== "true") {
            const storyId = this.dataset.storyId;
            const commentsList = commentSection.querySelector(".comments-list");
            
            db.collection("comments")
              .where("storyId", "==", storyId)
              .orderBy("timestamp", "desc")
              .onSnapshot((snapshot) => {
                commentsList.innerHTML = "";
                snapshot.forEach(doc => {
                  const comment = doc.data();
                  const commentDiv = document.createElement("div");
                  commentDiv.className = "comment";
                  commentDiv.textContent = `${comment.user}: ${comment.text}`;
                  commentsList.appendChild(commentDiv);
                });
              });
            
            commentSection.dataset.loaded = "true";
          }
        });
      });

      // Gestion des likes
      document.querySelectorAll(".like-btn").forEach(btn => {
        const storyId = btn.dataset.storyId;
        const likeCount = btn.querySelector(".like-count");

        btn.addEventListener("click", () => {
          const storyRef = db.collection("stories").doc(storyId);
          db.runTransaction(async (transaction) => {
            const doc = await transaction.get(storyRef);
            const newLikes = (doc.data()?.likes || 0) + 1;
            transaction.update(storyRef, { likes: newLikes });
            likeCount.textContent = newLikes;
          });
        });

        db.collection("stories").doc(storyId).onSnapshot((doc) => {
          likeCount.textContent = doc.data()?.likes || 0;
        });
      });

      // Gestion des commentaires
      document.querySelectorAll(".comment-btn").forEach(btn => {
        btn.addEventListener("click", () => {
          const storyId = btn.dataset.storyId;
          const commentInput = btn.previousElementSibling;
          const text = commentInput.value.trim();
          
          if (text) {
            db.collection("comments").add({
              storyId,
              text,
              user: "Anonyme",
              timestamp: firebase.firestore.FieldValue.serverTimestamp()
            });
            commentInput.value = "";
          }
        });
      });

      // Mode nuit
      const bouton = document.getElementById("toggle-mode");
      bouton.addEventListener("click", () => {
        document.body.classList.toggle("nuit");
      });
    });
  </script>
</body>
</html>